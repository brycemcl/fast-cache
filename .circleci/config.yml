version: 2.1

jobs:
  zstd:
    resource_class: 'arm.large'
    # working_directory: /mnt/ramdisk
    # parallelism: 1
    docker:
      - image: node:18-slim
    steps:
      - run: npm install pnpm -g
      - run: apt-get update && apt-get install -y curl git openssh-client mbuffer tar zstd lz4 rclone
      - run: rclone config create cache "google cloud storage" location=us-east1 bucket_policy_only=true env_auth=true
      - checkout
      - run: pnpm install --ignore-scripts no-one-left-behind bloater sindresorhus.js digital-keyboard-demos vue-compment @ericmcornelius/ease @ngxvoice/ngx-voicelistner miguelcostero-ng2-toasty fhir2 webche axios-yet-another-proxy-fix react-native-template-vife pb-schema react-native-version-manager @rstacruz/pnpm 3.0.0 react-native-handcheque-engine react-misc-toolbox react-native-ok-sdk react-angular-component search-list-react wc-starterkit react-redux-demo1 primeng-custom merino big-bertha @southcn/ckeditor5-build-inline cordova-plugin-amplify-payment cordova-plugin-amplify-pay lrbceshi outils-ren search-input-react vue-size-tracker toyako babylonia carousel-react @novembrecom/zxcvbn freemamba @mblode/react-native-feather @boundless-inc/mobiledoc-dom-renderer first-app-lyfuci fishzero hello_world_founder react-websockets h5-templete patternx axios-retry-ano zyl a_react_reflux_demo canvas-fingerprint @astro-my/sign-request web-component-tester-bundle terrible-lodash ch3ck nguye kountexample tanngo @edoroshenko/codemirror lazy-bee-ui mhy cordova-plugin-tsp wcq-vue apc-youtube viber-botkit hendo-cli-luozheao hendo-cli cordova-plugin-demotoast @mhy/mhy @jonathansadowski/wpc-test learning_locker raptor-app dk_2018_1_1 betterlyearn2 gix-npm-server plugin_test01 wed_developer node-dingtalk-robot embark omni-common-ui bimn @namchey/linkpreview react-application-core cncjs mcashscan-frontend webcube ws-voice-infinity-global-module metamask-crx ws-intranet-global-module nuclide eslint-plugin-aurelia-event-aggregator ufp-core ws-react-base-dictionary ws-react-global-module @radic/build-tools-webpack caipi reskript @netdata/interactive-landscape @triotech/vue-core netdata-collectors-landscape smasher lodash-modularized gulp-frontend-tools prisme-flow gamelynx-gatsby mulp @hatiolab/things-shell npmc bslint nger-cli @plone/volto ws-react-modal-dialog joys-react-h5-scripts @wardpeet/gatsby khoom decdk roderic @dylanvann/gatsby npm shaocongwang electrode-archetype-react-app-dev @kuinox/testpackagethatnooneshoulduse @bhargav018/electrode-archetype-react-app-dev @salomvary/npm @kuinox/testpackagethatnooneshoulduseever bbolla-electrode-archetype-react-app-dev compute.io @mathieudutour/gatsby ipfs tovar.js advanced-boilerplate morphi @jayway/tds @egis/build-tools bb-lp-cli gridiron-example datetimemodule joys-react-scripts next-nodecms hornet-js-builder modeify hookedjs webpack-digest @schacker/hpack-cli react-base-starter-project rc-tools smashing-dev-tool brainfock ya-driver meshblu-core-dispatcher better-babel-cli @unction/complete icx4 linagora-rse rc-ts-scripts @npm-polymer/npm-polymer the-react-scripts @nodox/gatsby cordova-plugin-require-bluetoothle agneta-platform @atomist/automation-client dbz-flame-scripts react-scripts-xiag-sm f_yoshi fd-proxy-server create-reaction-app @curiostack/base-web olymp @things-real/shell treats abp-zero-template1 lackey-cms vue2do @0xcda7a/npm qxf2006hf0216 421752593pro boringbits mini-vue-validate npm5v nst-cli vai kibana-with-account reaktor em-project-dev @comunica/actor-init-sparql apim-ui fe-gulp @agneta/platform liutestatomic gatsby-songwang rm3 xys_cli rekit-studio-sdk xes-webpack-core @geppettoengine/geppetto-client @zypolo91/boot-script rescape-web pd-react-scripts maha ipfs-vue rah ice-assets validate.io insights-core ipfs-ci-test @mercateo/ws hornet-js-builder-new @pegakit/build-tools vue-cvs pangea @turf/turf @spatial/turf acklen-keystone passbolt-appjs vchat @nail-cli/core plate-model palo-express ficklebeans-create-admin-panel-app pegakit-build-tools kibana-123 @beisen/talent-core-build edgestack zero.lib sewing-kitten sku koa-react-isomorphic pro-admin-subapp azure-fwd hippo-fw saas-plat-native tradebase easynode azure fervor feds-cli datawheel-canon node_noya_test @davids-devel/rocket-translator @nlabs/lex build-boiler-plus @jimpick/ipfs keystone @eservices/servicebot @unaussprechlich/keystone koot redux-grid-example ldx-home-plate npm5 ensemblejs au-base @fev/fev canes mobiage nucleus-core @atk/pantry @builtbypixel/nucleus-core kibana yss-perseus @nut-project/cli carlover-react gatsby-theme-consumer-site webpackcc bookingbug-studio ng-cli-2 ignite cyb-cli nanachi-cli oddsmarket-site cyb-cli-s cra-all-the-things not-bundled-npm arch-keystone @twreporter/keystone rax-scripts @leontastic/gatsby expo-torq stormrage trv-expo kxg edencms ember-cli twreporter-keystone rc-ts-tools ng2-rest-swagger-generator streamsoftco-development enact-dev dev1-front-boot basenji @mrauhu/npm ghs-umami-tonkotsu-curator-devtools lithium-sdk yunxi-choerodon-front-boot react-scripts-pro app.io webdevkit-gug gda-scripts @ofm/build-tool angular-devkit-web3 yummy-flow @100tal-seg/seg-react kevio @redisrupt/testcafe @elumeo/jfs-core furtherjs nail-cli update-modules-for-lnpm webplatform-frontend tarantul nanachi-webpack altiore-react qhc_job_ui paas-front-boot-dev @modelo.io/apiui hiocs-front-boot @gem-mine/script cobalt-cli rocket-starter strapi-helper-plugin-test @omgjs/turbo strapi-helper-plugin lbglisting-cli passbolt-mad horizontec-keystone lightsight @interaktiv/dia-scripts jw-components-mobile aitomic-docs frameworkstein-base-webapp bit-bin ngx-amrs generator-white-label webpack-marauder @ubiquits/toolchain keystone-impatient keystone-nthrive @movinliao/mlb @zerothstack/toolchain codelane-react-scripts @meniga/cli mesh-dev-cli cloudlify-keystone @peterpme/keystone syue-cli node_che 
      - run: pnpm install --ignore-scripts
      # - run: pnpm run start:createData
      - run: pnpm run start:upload-zstd
      - run: pnpm run start:restore-zstd
  lz4:
    resource_class: 'arm.large'
    # working_directory: /mnt/ramdisk
    # parallelism: 1
    docker:
      - image: node:18-slim
    steps:
      - run: npm install pnpm -g
      - run: apt-get update && apt-get install -y curl git openssh-client mbuffer tar zstd lz4 rclone
      - run: rclone config create cache "google cloud storage" location=us-east1 bucket_policy_only=true env_auth=true
      - checkout
      - run: pnpm install --ignore-scripts no-one-left-behind bloater sindresorhus.js digital-keyboard-demos vue-compment @ericmcornelius/ease @ngxvoice/ngx-voicelistner miguelcostero-ng2-toasty fhir2 webche axios-yet-another-proxy-fix react-native-template-vife pb-schema react-native-version-manager @rstacruz/pnpm 3.0.0 react-native-handcheque-engine react-misc-toolbox react-native-ok-sdk react-angular-component search-list-react wc-starterkit react-redux-demo1 primeng-custom merino big-bertha @southcn/ckeditor5-build-inline cordova-plugin-amplify-payment cordova-plugin-amplify-pay lrbceshi outils-ren search-input-react vue-size-tracker toyako babylonia carousel-react @novembrecom/zxcvbn freemamba @mblode/react-native-feather @boundless-inc/mobiledoc-dom-renderer first-app-lyfuci fishzero hello_world_founder react-websockets h5-templete patternx axios-retry-ano zyl a_react_reflux_demo canvas-fingerprint @astro-my/sign-request web-component-tester-bundle terrible-lodash ch3ck nguye kountexample tanngo @edoroshenko/codemirror lazy-bee-ui mhy cordova-plugin-tsp wcq-vue apc-youtube viber-botkit hendo-cli-luozheao hendo-cli cordova-plugin-demotoast @mhy/mhy @jonathansadowski/wpc-test learning_locker raptor-app dk_2018_1_1 betterlyearn2 gix-npm-server plugin_test01 wed_developer node-dingtalk-robot embark omni-common-ui bimn @namchey/linkpreview react-application-core cncjs mcashscan-frontend webcube ws-voice-infinity-global-module metamask-crx ws-intranet-global-module nuclide eslint-plugin-aurelia-event-aggregator ufp-core ws-react-base-dictionary ws-react-global-module @radic/build-tools-webpack caipi reskript @netdata/interactive-landscape @triotech/vue-core netdata-collectors-landscape smasher lodash-modularized gulp-frontend-tools prisme-flow gamelynx-gatsby mulp @hatiolab/things-shell npmc bslint nger-cli @plone/volto ws-react-modal-dialog joys-react-h5-scripts @wardpeet/gatsby khoom decdk roderic @dylanvann/gatsby npm shaocongwang electrode-archetype-react-app-dev @kuinox/testpackagethatnooneshoulduse @bhargav018/electrode-archetype-react-app-dev @salomvary/npm @kuinox/testpackagethatnooneshoulduseever bbolla-electrode-archetype-react-app-dev compute.io @mathieudutour/gatsby ipfs tovar.js advanced-boilerplate morphi @jayway/tds @egis/build-tools bb-lp-cli gridiron-example datetimemodule joys-react-scripts next-nodecms hornet-js-builder modeify hookedjs webpack-digest @schacker/hpack-cli react-base-starter-project rc-tools smashing-dev-tool brainfock ya-driver meshblu-core-dispatcher better-babel-cli @unction/complete icx4 linagora-rse rc-ts-scripts @npm-polymer/npm-polymer the-react-scripts @nodox/gatsby cordova-plugin-require-bluetoothle agneta-platform @atomist/automation-client dbz-flame-scripts react-scripts-xiag-sm f_yoshi fd-proxy-server create-reaction-app @curiostack/base-web olymp @things-real/shell treats abp-zero-template1 lackey-cms vue2do @0xcda7a/npm qxf2006hf0216 421752593pro boringbits mini-vue-validate npm5v nst-cli vai kibana-with-account reaktor em-project-dev @comunica/actor-init-sparql apim-ui fe-gulp @agneta/platform liutestatomic gatsby-songwang rm3 xys_cli rekit-studio-sdk xes-webpack-core @geppettoengine/geppetto-client @zypolo91/boot-script rescape-web pd-react-scripts maha ipfs-vue rah ice-assets validate.io insights-core ipfs-ci-test @mercateo/ws hornet-js-builder-new @pegakit/build-tools vue-cvs pangea @turf/turf @spatial/turf acklen-keystone passbolt-appjs vchat @nail-cli/core plate-model palo-express ficklebeans-create-admin-panel-app pegakit-build-tools kibana-123 @beisen/talent-core-build edgestack zero.lib sewing-kitten sku koa-react-isomorphic pro-admin-subapp azure-fwd hippo-fw saas-plat-native tradebase easynode azure fervor feds-cli datawheel-canon node_noya_test @davids-devel/rocket-translator @nlabs/lex build-boiler-plus @jimpick/ipfs keystone @eservices/servicebot @unaussprechlich/keystone koot redux-grid-example ldx-home-plate npm5 ensemblejs au-base @fev/fev canes mobiage nucleus-core @atk/pantry @builtbypixel/nucleus-core kibana yss-perseus @nut-project/cli carlover-react gatsby-theme-consumer-site webpackcc bookingbug-studio ng-cli-2 ignite cyb-cli nanachi-cli oddsmarket-site cyb-cli-s cra-all-the-things not-bundled-npm arch-keystone @twreporter/keystone rax-scripts @leontastic/gatsby expo-torq stormrage trv-expo kxg edencms ember-cli twreporter-keystone rc-ts-tools ng2-rest-swagger-generator streamsoftco-development enact-dev dev1-front-boot basenji @mrauhu/npm ghs-umami-tonkotsu-curator-devtools lithium-sdk yunxi-choerodon-front-boot react-scripts-pro app.io webdevkit-gug gda-scripts @ofm/build-tool angular-devkit-web3 yummy-flow @100tal-seg/seg-react kevio @redisrupt/testcafe @elumeo/jfs-core furtherjs nail-cli update-modules-for-lnpm webplatform-frontend tarantul nanachi-webpack altiore-react qhc_job_ui paas-front-boot-dev @modelo.io/apiui hiocs-front-boot @gem-mine/script cobalt-cli rocket-starter strapi-helper-plugin-test @omgjs/turbo strapi-helper-plugin lbglisting-cli passbolt-mad horizontec-keystone lightsight @interaktiv/dia-scripts jw-components-mobile aitomic-docs frameworkstein-base-webapp bit-bin ngx-amrs generator-white-label webpack-marauder @ubiquits/toolchain keystone-impatient keystone-nthrive @movinliao/mlb @zerothstack/toolchain codelane-react-scripts @meniga/cli mesh-dev-cli cloudlify-keystone @peterpme/keystone syue-cli node_che 
      - run: pnpm install --ignore-scripts
      # - run: pnpm run start:createData
      - run: pnpm run start:upload-lz4
      - run: pnpm run start:restore-lz4
  circleci:
    resource_class: 'arm.large'
    # working_directory: /mnt/ramdisk
    # parallelism: 1
    docker:
      - image: node:18-slim
    steps:
      - run: npm install pnpm -g
      - checkout
      - run: pnpm install --ignore-scripts no-one-left-behind bloater sindresorhus.js digital-keyboard-demos vue-compment @ericmcornelius/ease @ngxvoice/ngx-voicelistner miguelcostero-ng2-toasty fhir2 webche axios-yet-another-proxy-fix react-native-template-vife pb-schema react-native-version-manager @rstacruz/pnpm 3.0.0 react-native-handcheque-engine react-misc-toolbox react-native-ok-sdk react-angular-component search-list-react wc-starterkit react-redux-demo1 primeng-custom merino big-bertha @southcn/ckeditor5-build-inline cordova-plugin-amplify-payment cordova-plugin-amplify-pay lrbceshi outils-ren search-input-react vue-size-tracker toyako babylonia carousel-react @novembrecom/zxcvbn freemamba @mblode/react-native-feather @boundless-inc/mobiledoc-dom-renderer first-app-lyfuci fishzero hello_world_founder react-websockets h5-templete patternx axios-retry-ano zyl a_react_reflux_demo canvas-fingerprint @astro-my/sign-request web-component-tester-bundle terrible-lodash ch3ck nguye kountexample tanngo @edoroshenko/codemirror lazy-bee-ui mhy cordova-plugin-tsp wcq-vue apc-youtube viber-botkit hendo-cli-luozheao hendo-cli cordova-plugin-demotoast @mhy/mhy @jonathansadowski/wpc-test learning_locker raptor-app dk_2018_1_1 betterlyearn2 gix-npm-server plugin_test01 wed_developer node-dingtalk-robot embark omni-common-ui bimn @namchey/linkpreview react-application-core cncjs mcashscan-frontend webcube ws-voice-infinity-global-module metamask-crx ws-intranet-global-module nuclide eslint-plugin-aurelia-event-aggregator ufp-core ws-react-base-dictionary ws-react-global-module @radic/build-tools-webpack caipi reskript @netdata/interactive-landscape @triotech/vue-core netdata-collectors-landscape smasher lodash-modularized gulp-frontend-tools prisme-flow gamelynx-gatsby mulp @hatiolab/things-shell npmc bslint nger-cli @plone/volto ws-react-modal-dialog joys-react-h5-scripts @wardpeet/gatsby khoom decdk roderic @dylanvann/gatsby npm shaocongwang electrode-archetype-react-app-dev @kuinox/testpackagethatnooneshoulduse @bhargav018/electrode-archetype-react-app-dev @salomvary/npm @kuinox/testpackagethatnooneshoulduseever bbolla-electrode-archetype-react-app-dev compute.io @mathieudutour/gatsby ipfs tovar.js advanced-boilerplate morphi @jayway/tds @egis/build-tools bb-lp-cli gridiron-example datetimemodule joys-react-scripts next-nodecms hornet-js-builder modeify hookedjs webpack-digest @schacker/hpack-cli react-base-starter-project rc-tools smashing-dev-tool brainfock ya-driver meshblu-core-dispatcher better-babel-cli @unction/complete icx4 linagora-rse rc-ts-scripts @npm-polymer/npm-polymer the-react-scripts @nodox/gatsby cordova-plugin-require-bluetoothle agneta-platform @atomist/automation-client dbz-flame-scripts react-scripts-xiag-sm f_yoshi fd-proxy-server create-reaction-app @curiostack/base-web olymp @things-real/shell treats abp-zero-template1 lackey-cms vue2do @0xcda7a/npm qxf2006hf0216 421752593pro boringbits mini-vue-validate npm5v nst-cli vai kibana-with-account reaktor em-project-dev @comunica/actor-init-sparql apim-ui fe-gulp @agneta/platform liutestatomic gatsby-songwang rm3 xys_cli rekit-studio-sdk xes-webpack-core @geppettoengine/geppetto-client @zypolo91/boot-script rescape-web pd-react-scripts maha ipfs-vue rah ice-assets validate.io insights-core ipfs-ci-test @mercateo/ws hornet-js-builder-new @pegakit/build-tools vue-cvs pangea @turf/turf @spatial/turf acklen-keystone passbolt-appjs vchat @nail-cli/core plate-model palo-express ficklebeans-create-admin-panel-app pegakit-build-tools kibana-123 @beisen/talent-core-build edgestack zero.lib sewing-kitten sku koa-react-isomorphic pro-admin-subapp azure-fwd hippo-fw saas-plat-native tradebase easynode azure fervor feds-cli datawheel-canon node_noya_test @davids-devel/rocket-translator @nlabs/lex build-boiler-plus @jimpick/ipfs keystone @eservices/servicebot @unaussprechlich/keystone koot redux-grid-example ldx-home-plate npm5 ensemblejs au-base @fev/fev canes mobiage nucleus-core @atk/pantry @builtbypixel/nucleus-core kibana yss-perseus @nut-project/cli carlover-react gatsby-theme-consumer-site webpackcc bookingbug-studio ng-cli-2 ignite cyb-cli nanachi-cli oddsmarket-site cyb-cli-s cra-all-the-things not-bundled-npm arch-keystone @twreporter/keystone rax-scripts @leontastic/gatsby expo-torq stormrage trv-expo kxg edencms ember-cli twreporter-keystone rc-ts-tools ng2-rest-swagger-generator streamsoftco-development enact-dev dev1-front-boot basenji @mrauhu/npm ghs-umami-tonkotsu-curator-devtools lithium-sdk yunxi-choerodon-front-boot react-scripts-pro app.io webdevkit-gug gda-scripts @ofm/build-tool angular-devkit-web3 yummy-flow @100tal-seg/seg-react kevio @redisrupt/testcafe @elumeo/jfs-core furtherjs nail-cli update-modules-for-lnpm webplatform-frontend tarantul nanachi-webpack altiore-react qhc_job_ui paas-front-boot-dev @modelo.io/apiui hiocs-front-boot @gem-mine/script cobalt-cli rocket-starter strapi-helper-plugin-test @omgjs/turbo strapi-helper-plugin lbglisting-cli passbolt-mad horizontec-keystone lightsight @interaktiv/dia-scripts jw-components-mobile aitomic-docs frameworkstein-base-webapp bit-bin ngx-amrs generator-white-label webpack-marauder @ubiquits/toolchain keystone-impatient keystone-nthrive @movinliao/mlb @zerothstack/toolchain codelane-react-scripts @meniga/cli mesh-dev-cli cloudlify-keystone @peterpme/keystone syue-cli node_che 
      - run: pnpm install --ignore-scripts
      # - run: pnpm run start:createData
      - save_cache:
          key: v1-{{ .Environment.CIRCLE_JOB }}-{{ .Environment.CIRCLE_SHA1 }}-{{ .Environment.CIRCLE_NODE_INDEX }}
          paths:
            - node_modules/
      - run: mv node_modules uploads.old
      - restore_cache:
          keys:
            - v1-{{ .Environment.CIRCLE_JOB }}-{{ .Environment.CIRCLE_SHA1 }}-{{ .Environment.CIRCLE_NODE_INDEX }}

workflows:
  comparison:
    jobs:
      - lz4
      - zstd:
          requires:
            - lz4
      - circleci:
          requires:
            - zstd